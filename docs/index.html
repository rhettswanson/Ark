<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Ark – MP webcomponent (diag)</title>
  <style>
    :root { color-scheme: dark; }
    html,body { height:100%; margin:0; background:#111; color:#eee; }
    matterport-viewer { display:block; inline-size:100%; block-size:100dvh; }
    .badge {
      position:absolute; left:10px; top:10px; z-index:5;
      padding:6px 10px; font:12px system-ui;
      background:rgba(0,0,0,.55); border:1px solid #333; border-radius:8px;
      user-select:none
    }
  </style>

  <!-- Local showcase CSS -->
  <link rel="stylesheet" href="./css/showcase.css" />

  <!-- Import map (local ESM + local three) -->
  <script type="importmap">
  {
    "imports": {
      "three": "./vendors/three/0.176.0/build/three.module.js",
      "three/addons/": "./vendors/three/0.176.0/examples/jsm/",
      "@matterport/webcomponent": "./vendors/matterport-webcomponent/0.1.45/matterport-viewer.esm.js"
    }
  }
  </script>
</head>
<body>
  <div class="badge" id="badge">booting…</div>

  <matterport-viewer id="mp"
    m="1ghABoaBFPZ"
    application-key="akqd0dp3hr9wz4eu70zd1rsab"
    asset-base="/Ark"
    play
    title="false" brand="false" style="outline:0">
  </matterport-viewer>

  <script type="module">
    import "@matterport/webcomponent";

    const el = document.getElementById('mp');
    const badge = document.getElementById('badge');
    const set = (t) => badge.textContent = t;

    // Verbose event logging (no timeouts)
    const events = [
      'mpReady','mpPlaying','mpPaused','mpProgress',
      'mpCameraAvailable','mpNavigationChanged',
      'mpError','mpSdkError'
    ];
    events.forEach(ev => el.addEventListener(ev, e => {
      console.log(`[${ev}]`, e.detail ?? null);
      if (ev === 'mpProgress') {
        const p = (e.detail?.progress ?? 0) * 100;
        set(`loading ${Math.round(p)}%`);
      }
      if (ev === 'mpReady') set('ready…');
      if (ev === 'mpPlaying') set('playing');
      if (ev === 'mpPaused') set('paused');
      if (ev === 'mpError' || ev === 'mpSdkError') set('error — see console');
    }));

    el.addEventListener('mpSdkPlaying', async (e) => {
      try {
        const sdk = e.detail.mpSdk;
        set('SDK connected — fetching model…');
        const info = await sdk.Model.getData();
        set(`SDK ✓ model: ${info.sid}`);
      } catch (err) {
        console.error(err);
        set('SDK model error (see console)');
      }
    });
  </script>
</body>
</html>